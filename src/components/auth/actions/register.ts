"use server";
import { connectToDatabase } from "@/lib/utils";
import Admin from "@/models/adminModal";
import bcryptjs from "bcryptjs";
import { redirect } from "next/navigation";

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////

const credentialsSignUp = async (
  name: string,
  phoneNumber: string,
  email: string,
  password: string
) => {
  try {
    await connectToDatabase();
  } catch (error) {
    console.error("Failed to connect to the database:", error);
    throw new Error("Internal server error");
  }


  ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////


  let candidate = await Admin.findOne({ email });


  ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////

  if (candidate) {
    redirect("/auth/login");
  }

  ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////

  const salt = await bcryptjs.genSalt(10);
  const hashedPassword = await bcryptjs.hash(password, salt);

  ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////


  candidate = await Admin.create({
    name,
    phoneNumber,
    email,
    password: hashedPassword,
  });
};

export { credentialsSignUp };

